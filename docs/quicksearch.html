<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"lib_gelfFormatter.js.html":{"id":"lib_gelfFormatter.js.html","title":"Source: lib/gelfFormatter.js","body":" case-logger Modules case-logger Global gelfFormatterrequest Source: lib/gelfFormatter.js var hostname = require('os').hostname() /** * @summary Devuelve un objeto GELF estándar a partir de los parámetros. * @access private * @example { * &quot;version&quot;: &quot;1.1&quot;, * &quot;host&quot;: &quot;example.org&quot;, * &quot;short_message&quot;: &quot;A short message that helps you identify what is going on&quot;, * &quot;full_message&quot;: &quot;Backtrace here\\n\\nmore stuff&quot;, * &quot;timestamp&quot;: 1385053862.3072, * &quot;level&quot;: 1, * &quot;_user_id&quot;: 9001, * &quot;_some_info&quot;: &quot;foo&quot;, * &quot;_some_env_var&quot;: &quot;bar&quot; *} * @see {@link http://docs.graylog.org/en/2.0/pages/gelf.html#gelf-format-specification|GELF Format Specification} * @param {string} type La criticidad (level) del mensaje * @param {string} namespace El nombre que identifica al script que lanza este Logger * @param {string} shortMessage A short descriptive message; MUST be set by client library. * @param {string} fullMessage A long message that can i.e. contain a backtrace; optional. * @return {object} Objeto con formato GELF estándar */ var gelfFormatter = function gelfFormatter (type, namespace, shortMessage, fullMessage) { var levels = { error: 1, warn: 4, log: 5, info: 6, debug: 7 } var GELFmessage = { namespace: namespace.split(':').join('-'), hostname: hostname, level: levels[type] || 1, short_message: shortMessage, full_message: fullMessage, // Si es undefined, graylog no lo registra timestamp: Math.round(new Date() / 1000) } return GELFmessage } module.exports = gelfFormatter × Search results Close "},"index.js.html":{"id":"index.js.html","title":"Source: index.js","body":" case-logger Modules case-logger Global gelfFormatterrequest Source: index.js /** * Reporta logs a Graylog y muestra por consola al estilo Debug. * @module case-logger */ var debug = require('debug') var request = require('./lib/request.js') var gelfFormatter = require('./lib/gelfFormatter.js') /** * @summary Interfaz con los métodos que se pueden usar para loguear. * @access public * @description Según el nivel de log que se quiera usar, hay distintos métodos disponibles. Todos ellos menos el nivel &lt;i&gt;debug&lt;/i&gt; envían a Graylog. * @param {String|Object} options Opciones de inicialización del módulo. (Si sólo se pasa un string, será el &lt;code&gt;namespace&lt;/code&gt;) * @param {String} options.namespace El identificador del script que llama al Logger. * @param {Boolean} options.logger (Opcional) Si enviar el mensaje a Graylog o no. * @return {API} La salida en consola, al estilo Debug. */ var Logger = function Logger (options) { // Build module Options object var moduleOptions = {} if (typeof options !== 'string') { Object.assign(moduleOptions, options) } else { moduleOptions.namespace = options } if (!moduleOptions.namespace) { throw new Error('Namespace no definido en las opciones') } // Instantiate each constructor and cache them for performance boost var ERROR = debug(moduleOptions.namespace + ':error') var WARN = debug(moduleOptions.namespace + ':warn') var LOG = debug(moduleOptions.namespace + ':log') var INFO = debug(moduleOptions.namespace + ':info') var DEBUG = debug(moduleOptions.namespace + ':debug') // Public methods var API = { error: function logError (shortMessage, ...fullMessage) { var formattedMessage = gelfFormatter('error', moduleOptions.namespace, shortMessage, fullMessage.join(' ')) /* istanbul ignore else */ if (moduleOptions.logger !== false) { request(formattedMessage, function () {}) } return ERROR(formattedMessage.short_message) }, warn: function logWarn (shortMessage, ...fullMessage) { var formattedMessage = gelfFormatter('warn', moduleOptions.namespace, shortMessage, fullMessage.join(' ')) /* istanbul ignore else */ if (moduleOptions.logger !== false) { request(formattedMessage, function () {}) } return WARN(formattedMessage.short_message) }, log: function logLog (shortMessage, ...fullMessage) { var formattedMessage = gelfFormatter('log', moduleOptions.namespace, shortMessage, fullMessage.join(' ')) /* istanbul ignore else */ if (moduleOptions.logger !== false) { request(formattedMessage, function () {}) } return LOG(formattedMessage.short_message) }, info: function logInfo (shortMessage, ...fullMessage) { var formattedMessage = gelfFormatter('info', moduleOptions.namespace, shortMessage, fullMessage.join(' ')) /* istanbul ignore else */ if (moduleOptions.logger !== false) { request(formattedMessage, function () {}) } return INFO(formattedMessage.short_message) }, debug: function logInfo (shortMessage, ...fullMessage) { var formattedMessage = gelfFormatter('debug', moduleOptions.namespace, shortMessage, fullMessage.join(' ')) return DEBUG(formattedMessage.short_message) } } return API } module.exports = Logger /** * @typedef {Object} API * @access public * @summary Los métodos de Logger que se pueden usar. * @property {APIFunc} error Loguear y enviar mensajes de nivel &lt;b&gt;error&lt;/b&gt;. * @property {APIFunc} warn Loguear y enviar mensajes de nivel &lt;b&gt;warning&lt;/b&gt;. * @property {APIFunc} log Loguear y enviar mensajes de nivel &lt;b&gt;log&lt;/b&gt;. * @property {APIFunc} info Loguear y enviar mensajes de nivel &lt;b&gt;info&lt;/b&gt;. * @property {APIFunc} debug Loguear mensajes de nivel &lt;b&gt;debug&lt;/b&gt;. &lt;u&gt;No se envían nunca a Graylog&lt;/u&gt;. */ /** * @typedef {Function} APIFunc * @access public * @summary Cada método que se puede usar en el Logger. * @description Aceptan strings que servirán para imprimirse en consola y enviarse a Graylog. * @property {string} shortMessage A short descriptive message; MUST be set by client library. * @property {string} fullMessage A long message that can i.e. contain a backtrace; optional. * @return {undefined} El mensaje en consola, al estilo DEBUG. */ × Search results Close "},"lib_request.js.html":{"id":"lib_request.js.html","title":"Source: lib/request.js","body":" case-logger Modules case-logger Global gelfFormatterrequest Source: lib/request.js var Request = require('request') var GRAYLOG_URL = 'http://graylog.caseonit.net:12201/gelf' /** * Enviar el mensaje de log a Graylog. * @access private * @param {object} body - El mensaje GELF a enviar * @param {requestCallback} callback - The callback that handles the response. */ function request (body, callback) { Request.post(GRAYLOG_URL, { json: true, body: body }, function (error, response, body) { if (error) { return callback(error, null) } if (!error &amp;&amp; response.statusCode === 202) { return callback(null, true) } return callback(null, false) }) } /** * @summary This callback is displayed as part of the Request class. * @access private * @callback requestCallback * @param {Error} error El error de la petición. * @param {Boolean} success Si el status devuelvo es exitoso (202) o no (cualquier otro) */ module.exports = request × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" case-logger Modules case-logger Global gelfFormatterrequest Global Methods &lt;private&gt; gelfFormatter(type, namespace, shortMessage, fullMessage) Devuelve un objeto GELF estándar a partir de los parámetros. Parameters: Name Type Description type string La criticidad (level) del mensaje namespace string El nombre que identifica al script que lanza este Logger shortMessage string A short descriptive message; MUST be set by client library. fullMessage string A long message that can i.e. contain a backtrace; optional. Source: lib/gelfFormatter.js, line 24 See: GELF Format Specification Returns: Objeto con formato GELF estándar Type object Example { &quot;version&quot;: &quot;1.1&quot;, &quot;host&quot;: &quot;example.org&quot;, &quot;short_message&quot;: &quot;A short message that helps you identify what is going on&quot;, &quot;full_message&quot;: &quot;Backtrace here\\n\\nmore stuff&quot;, &quot;timestamp&quot;: 1385053862.3072, &quot;level&quot;: 1, &quot;_user_id&quot;: 9001, &quot;_some_info&quot;: &quot;foo&quot;, &quot;_some_env_var&quot;: &quot;bar&quot; } &lt;private&gt; request(body, callback) Enviar el mensaje de log a Graylog. Enviar el mensaje de log a Graylog. Parameters: Name Type Description body object El mensaje GELF a enviar callback requestCallback The callback that handles the response. Source: lib/request.js, line 11 Type Definitions &lt;private&gt; requestCallback(error, success) This callback is displayed as part of the Request class. Parameters: Name Type Description error Error El error de la petición. success Boolean Si el status devuelvo es exitoso (202) o no (cualquier otro) Source: lib/request.js, line 28 × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" case-logger Modules case-logger Global gelfFormatterrequest Modules × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" case-logger Modules case-logger Global gelfFormatterrequest case-loggerMódulo para hacer logs de las aplicaciones y enviarlos a un recolector de logs para analizarlos. Responsable: Miguel Herrero InstalaciónInstala la dependencia en package.json con la VERSIÓN que quieras: &quot;dependencies&quot;: { &quot;case-logger&quot;: &quot;git+https://707d3242d7f4d30295f57d7914148ac6524408ba:x-oauth-basic@github.com/abatiz/case-modules-logger.git#VERSIÓN&quot; }Importa el módulo y asígnale un namespace identificativo para tu script: var Logger = require('case-logger')('myApp:plugin:speedtest');Se le puede pasar un objeto de opciones, donde se puede quitar que se envíen a Graylog. var Logger = require('./index.js')({ logger: false, namespace: 'myApp:plugin:speedtest' });Métodos de logsTodos los métodos aceptan dos parámetros: (String, requerido): el título del log. (String, opcional): un mensaje completo del log; el stacktrace del error por ejemplo. error()Level 1. En este nivel de log, se debe actuar inmediatamente. Logger.error('No se encuentra el socket de conexión a MongoDB', stackTrace);warn()Level 4. Condiciones de peligro, que pueden llevar a error si no se toman acciones. Hay que tratar de solucionarlo. Logger.warn('Código de MCC y MNC no encontrado en BD. Configuración no se ha podido devolver al usuario');log()Level 5. Eventos que son inusuales pero significativos, y que no pueden llevar a condición de error. Logger.log('El documento no tiene velocidades medias para calcular el total');info()Level 6. Mensajes normales de operaciones; pueden usarse para informes, mediciones… No se requiere intervención. Logger.info('Obtenida configuración de la sonda de la DB');debug()Level 7. Mensajes de depuración, útiles para los desarrolladores durante el desarrollo de la app. No útiles durante las operaciones. Este nivel de log en ningún caso envía datos a Graylog. Logger.debug('Configuración obtenida de la DB en 8754 ms');Niveles de logEn conformidad con la GELF Format Specification, los niveles de logs son iguales a los niveles estándar de syslog (RFC 3164): Numerical Code Severity Equivalent Logger method 0 Emergency: system is unusable 1 Alert: action must be taken immediately error 2 Critical: critical conditions 3 Error: error conditions 4 Warning: warning conditions warn 5 Notice: normal but significant condition log 6 Informational: informational messages info 7 Debug: debug-level messages debug Código completo de ejemploCopia este código en un archivo javascript: var stackTraceExample = 'Error: Things keep happening! at /home/gbusey/file.js:525:2 at Frobnicator.refrobulate (/home/gbusey/business-logic.js:424:21) at Actor.&lt;anonymous&gt; (/home/gbusey/actors.js:400:8) at increaseSynergy (/home/gbusey/actors.js:701:6)' /** * If no options are passed, default Graylog is used */ var LogWithoutOptions = require('case-logger')('myApp:myScript') LogWithoutOptions.error('Alert: action must be taken immediately', stackTraceExample) LogWithoutOptions.warn('Warning: warning conditions') LogWithoutOptions.log('Notice: normal but significant condition') LogWithoutOptions.info('Informational: informational messages') LogWithoutOptions.debug('Debug: debug-level messages')Ejecútalo con DEBUG=* node example.js y verás en Graylog los datos enviados. Analizar la información en GraylogLa información que se recibe en Graylog es: timestamp (cuándo se envió el log) hostname (quién generó el log) source (la IP de quien generó el log) level (nivel de criticidad, de acuerdo con los Niveles de log según el método usado) namespace (el script que generó el log) message (título del log) full_message (si lo hay, mensaje completo del log) ContribucionesCualquier sugerencia, fallo o mejora, abre una issue. × Search results Close "},"module-case-logger.html":{"id":"module-case-logger.html","title":"Module: case-logger","body":" case-logger Modules case-logger Global gelfFormatterrequest Module: case-logger Reporta logs a Graylog y muestra por consola al estilo Debug. Source: index.js, line 1 Methods &lt;inner&gt; Logger(options) Interfaz con los métodos que se pueden usar para loguear. Según el nivel de log que se quiera usar, hay distintos métodos disponibles. Todos ellos menos el nivel debug envían a Graylog. Parameters: Name Type Description options String | Object Opciones de inicialización del módulo. (Si sólo se pasa un string, será el namespace) Properties Name Type Description namespace String El identificador del script que llama al Logger. logger Boolean (Opcional) Si enviar el mensaje a Graylog o no. Source: index.js, line 18 Returns: La salida en consola, al estilo Debug. Type API Type Definitions API Los métodos de Logger que se pueden usar. Type: Object Properties: Name Type Description error APIFunc Loguear y enviar mensajes de nivel error. warn APIFunc Loguear y enviar mensajes de nivel warning. log APIFunc Loguear y enviar mensajes de nivel log. info APIFunc Loguear y enviar mensajes de nivel info. debug APIFunc Loguear mensajes de nivel debug. No se envían nunca a Graylog. Source: index.js, line 97 APIFunc() Cada método que se puede usar en el Logger. Aceptan strings que servirán para imprimirse en consola y enviarse a Graylog. Properties: Name Type Description shortMessage string A short descriptive message; MUST be set by client library. fullMessage string A long message that can i.e. contain a backtrace; optional. Source: index.js, line 108 Returns: El mensaje en consola, al estilo DEBUG. Type undefined × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
